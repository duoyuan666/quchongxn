<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦å›¾ç‰‡åŸåˆ›åº¦å¢å¼ºå·¥å…· Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.2/spark-md5.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FF9A9E 0%, #FAD0C4 50%, #FFD1FF 100%);
            color: #333;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 18px;
            line-height: 1.6;
            color: #555;
        }

        .content {
            padding: 50px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #FF6B9D;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #FF6B9D;
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .theme-card {
            border: 3px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
            text-align: center;
        }

        .theme-card:hover {
            border-color: #FF6B9D;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }

        .theme-card.active {
            border-color: #FF6B9D;
            background: linear-gradient(135deg, #fff0f5 0%, #ffe8f0 100%);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
        }

        .theme-card h3 {
            color: #FF6B9D;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .theme-card p {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
        }

        .theme-preview {
            width: 100%;
            height: 120px;
            margin-bottom: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .upload-zone {
            border: 3px dashed #FF6B9D;
            border-radius: 15px;
            padding: 60px;
            text-align: center;
            background: #fff0f5;
            cursor: pointer;
            transition: all 0.3s;
            margin: 25px 0;
        }

        .upload-zone:hover {
            background: #ffe8f0;
            border-color: #FF1493;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .image-item {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 12px;
            background: #fafafa;
            position: relative;
        }

        .image-item img {
            width: 100%;
            border-radius: 8px;
        }

        .config-panel {
            background: #fff0f5;
            border: 2px solid #FF6B9D;
            border-radius: 12px;
            padding: 30px;
            margin: 25px 0;
        }

        .config-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        .config-item {
            margin-bottom: 20px;
        }

        .config-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            font-size: 15px;
        }

        .config-item input[type="number"],
        .config-item input[type="text"],
        .config-item select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
        }

        .text-sticker-builder {
            background: white;
            border: 2px solid #FF6B9D;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .sticker-preset-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .sticker-preset {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .sticker-preset:hover {
            border-color: #FF6B9D;
            background: #fff0f5;
            transform: scale(1.05);
        }

        .sticker-preset.selected {
            background: #FF6B9D;
            color: white;
            border-color: #FF6B9D;
        }

        button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #FF6B9D 0%, #FF1493 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 8px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: #f0f0f0;
            border-radius: 20px;
            overflow: hidden;
            margin: 25px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B9D 0%, #FF1493 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 5px solid #4A90E2;
            padding: 20px 25px;
            margin: 25px 0;
            border-radius: 8px;
        }

        .status-message {
            padding: 18px 25px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
            font-size: 15px;
        }

        .status-message.show {
            display: block;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .result-panel {
            background: #f8f9fa;
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 30px;
            margin: 25px 0;
        }

        .md5-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .md5-table th,
        .md5-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .md5-table th {
            background: #FF6B9D;
            color: white;
            font-weight: 600;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .custom-sticker-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            display: inline-block;
            margin: 5px;
        }

        .color-option:hover {
            transform: scale(1.15);
        }

        .color-option.selected {
            border-color: #333;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ å°çº¢ä¹¦å›¾ç‰‡åŸåˆ›åº¦å¢å¼ºå·¥å…· Pro</h1>
            <p>æ‰‹ç»˜é£æ ¼è¾¹æ¡† + æ•™è‚²åœºæ™¯åŒ–è´´çº¸ = çˆ†æ¬¾ç¬”è®°é£æ ¼<br>
            è®©æ¯å¼ å›¾ç‰‡éƒ½åƒç²¾å¿ƒè®¾è®¡çš„æ‰‹å¸,å¤§å¹…æå‡åŸåˆ›åº¦å’Œç‚¹å‡»ç‡!</p>
        </div>

        <div class="content">
            <!-- ä¸»é¢˜é€‰æ‹© -->
            <div class="section">
                <h2>ğŸ¯ ç¬¬ä¸€æ­¥: é€‰æ‹©ä¸»é¢˜é£æ ¼ (ä¸€é”®åº”ç”¨å®Œæ•´é£æ ¼)</h2>

                <div class="theme-selector">
                    <div class="theme-card active" id="theme1" onclick="selectTheme('fresh')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #FFE5EC 0%, #FFF0F5 100%); border: 3px dashed #FFB6C1;">
                            <div style="position: absolute; top: 5px; left: 10px; background: #FFB6C1; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">DAY 1</div>
                            <span>â­ âœ¨ ğŸ’–</span>
                        </div>
                        <h3>æ¸…æ–°æ‰‹å¸é£</h3>
                        <p>æ³¢æµªè¾¹æ¡†+å°èŠ±æ˜Ÿæ˜Ÿ<br>ç²‰è“é»„é…è‰²</p>
                    </div>

                    <div class="theme-card" id="theme2" onclick="selectTheme('notebook')">
                        <div class="theme-preview" style="background: #FFF8DC; border-left: 10px solid #DEB887;">
                            <div style="position: absolute; top: 5px; left: 15px; background: #8B4513; color: white; padding: 3px 8px; border-radius: 5px; font-size: 12px;">ğŸ“</div>
                            <span>ç¬”è®°æœ¬é£æ ¼</span>
                        </div>
                        <h3>ç¬”è®°æœ¬é£æ ¼</h3>
                        <p>èºæ—‹æœ¬è¾¹æ¡†+DAYæ ‡ç­¾<br>é“…ç¬”å¯¹å‹¾</p>
                    </div>

                    <div class="theme-card" id="theme3" onclick="selectTheme('motivational')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF69B4 100%);">
                            <div style="position: absolute; top: 8px; right: 8px; font-size: 24px;">ğŸ†</div>
                            <span style="color: white; font-weight: 700;">ä½ çœŸæ£’!</span>
                        </div>
                        <h3>æ¿€åŠ±æ‰“å¡é£</h3>
                        <p>å½©è™¹è¾¹æ¡†+æ¿€åŠ±æ–‡å­—<br>å¥–æ¯æ‰“å¡</p>
                    </div>

                    <div class="theme-card" id="theme4" onclick="selectTheme('serious')">
                        <div class="theme-preview" style="background: white; border: 2px solid #333;">
                            <div style="position: absolute; top: 5px; left: 10px; background: #FF6B6B; color: white; padding: 3px 10px; border-radius: 3px; font-size: 12px;">é‡ç‚¹</div>
                            <span style="color: #333;">ä¸¥è‚ƒå­¦ä¹ </span>
                        </div>
                        <h3>ä¸¥è‚ƒå­¦ä¹ é£</h3>
                        <p>ç›´çº¿è¾¹æ¡†+é‡ç‚¹æ ‡ç­¾<br>ç®­å¤´åºå·</p>
                    </div>

                    <div class="theme-card" id="theme5" onclick="selectTheme('cute')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #FFB6D9 0%, #C1E1FF 100%); border-radius: 20px;">
                            <div style="position: absolute; top: 5px; left: 5px; font-size: 20px;">ğŸ’–</div>
                            <div style="position: absolute; bottom: 5px; right: 5px; font-size: 20px;">ğŸŒ¸</div>
                            <span>å¯çˆ±å¡é€š</span>
                        </div>
                        <h3>å¯çˆ±å¡é€šé£</h3>
                        <p>çˆ±å¿ƒè¾¹æ¡†+å¯çˆ±æ–‡å­—<br>é©¬å¡é¾™è‰²</p>
                    </div>
                </div>

                <div class="info-box">
                    <h4 style="color: #4A90E2; margin-bottom: 10px;">ğŸ’¡ å½“å‰ä¸»é¢˜: <span id="currentThemeName">æ¸…æ–°æ‰‹å¸é£</span></h4>
                    <p style="color: #666; line-height: 1.6;">é€‰æ‹©ä¸»é¢˜å,è¾¹æ¡†ã€è´´çº¸ã€é¢œè‰²å°†è‡ªåŠ¨é…ç½®ä¸ºæœ€ä½³ç»„åˆã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨ä¸‹æ–¹è‡ªå®šä¹‰è°ƒæ•´ã€‚</p>
                </div>
            </div>

            <!-- ä¸Šä¼ å›¾ç‰‡ -->
            <div class="section">
                <h2>ğŸ“¤ ç¬¬äºŒæ­¥: ä¸Šä¼ å›¾ç‰‡</h2>

                <div class="upload-zone" id="uploadZone">
                    <p style="font-size: 48px; margin-bottom: 20px;">ğŸ–¼ï¸</p>
                    <p style="font-size: 24px; color: #FF6B9D; margin-bottom: 20px;">æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</p>
                    <p style="color: #666; margin-bottom: 25px;">æˆ–è€…</p>
                    <label for="imageInput" style="display: inline-block; padding: 15px 40px; background: #FF6B9D; color: white; border-radius: 10px; cursor: pointer; font-size: 16px;">
                        ç‚¹å‡»é€‰æ‹©å›¾ç‰‡
                    </label>
                    <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                    <p style="color: #999; font-size: 14px; margin-top: 20px;">æ”¯æŒJPGã€PNGæ ¼å¼,å»ºè®®æ¯ç»„1-20å¼ </p>
                </div>

                <div class="image-grid" id="imageGrid"></div>

                <div class="btn-group" id="uploadButtons" style="display: none;">
                    <button id="clearAll" style="background: #dc3545;">æ¸…ç©ºæ‰€æœ‰å›¾ç‰‡</button>
                </div>

                <div class="status-message" id="uploadStatus"></div>
            </div>

            <!-- è£…é¥°é…ç½® -->
            <div class="section">
                <h2>ğŸ¨ ç¬¬ä¸‰æ­¥: è‡ªå®šä¹‰è£…é¥° (å¯é€‰)</h2>

                <div class="config-panel">
                    <h3 style="color: #FF6B9D; margin-bottom: 20px;">è¾¹æ¡†è®¾ç½®</h3>

                    <div class="config-row">
                        <div class="config-item">
                            <label>è¾¹æ¡†æ ·å¼:</label>
                            <select id="borderStyle">
                                <option value="wavy">æ‰‹ç»˜æ³¢æµªè¾¹æ¡† (æ¨è)</option>
                                <option value="dashed">è™šçº¿è¾¹æ¡†</option>
                                <option value="decorated">è£…é¥°è¾¹æ¡† (å››è§’çˆ±å¿ƒ)</option>
                                <option value="notebook">ç¬”è®°æœ¬é£æ ¼</option>
                                <option value="solid">çº¯è‰²è¾¹æ¡†</option>
                                <option value="gradient">æ¸å˜è¾¹æ¡†</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label>è¾¹æ¡†å®½åº¦:</label>
                            <input type="number" id="borderWidth" min="15" max="60" value="25">
                        </div>

                        <div class="config-item">
                            <label>åœ†è§’å¤§å°:</label>
                            <input type="number" id="borderRadius" min="0" max="40" value="15">
                        </div>
                    </div>

                    <hr style="margin: 30px 0; border: none; border-top: 2px solid #ddd;">

                    <h3 style="color: #FF6B9D; margin-bottom: 20px;">æ–‡å­—è´´çº¸ (ä¸­æ–‡æ¿€åŠ±/å­¦ç§‘æ ‡ç­¾)</h3>

                    <div class="text-sticker-builder">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block;">å¿«é€Ÿé€‰æ‹©é¢„è®¾è´´çº¸:</label>

                        <h4 style="margin: 15px 0 10px; color: #666; font-size: 14px;">æ¿€åŠ±ç±»:</h4>
                        <div class="sticker-preset-grid">
                            <div class="sticker-preset" onclick="toggleSticker(this, 'åŠ æ²¹')" style="background: #FFD700;">åŠ æ²¹</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'åŠªåŠ›')" style="background: #FFA500;">åŠªåŠ›</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'ä½ çœŸæ£’!')" style="background: #FF69B4;">ä½ çœŸæ£’!</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'å¤ªå‰å®³äº†!')" style="background: #FF1493;">å¤ªå‰å®³äº†!</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'èƒ½é‡æ»¡æ»¡')" style="background: #FFB6C1;">èƒ½é‡æ»¡æ»¡</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'ç»§ç»­åŠ æ²¹')" style="background: #FFC0CB;">ç»§ç»­åŠ æ²¹</div>
                        </div>

                        <h4 style="margin: 15px 0 10px; color: #666; font-size: 14px;">å­¦ç§‘ç±»:</h4>
                        <div class="sticker-preset-grid">
                            <div class="sticker-preset" onclick="toggleSticker(this, 'æ•°å­¦å°å¤©æ‰')" style="background: #87CEEB;">æ•°å­¦å°å¤©æ‰</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'è¯­æ–‡å°è¾¾äºº')" style="background: #98FB98;">è¯­æ–‡å°è¾¾äºº</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'è‹±è¯­å•è¯ç‹')" style="background: #DDA0DD;">è‹±è¯­å•è¯ç‹</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'è®¡ç®—å°èƒ½æ‰‹')" style="background: #F0E68C;">è®¡ç®—å°èƒ½æ‰‹</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'é˜…è¯»ä¹‹æ˜Ÿ')" style="background: #E0BBE4;">é˜…è¯»ä¹‹æ˜Ÿ</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'å­¦éœ¸å…»æˆè®°')" style="background: #FFDAB9;">å­¦éœ¸å…»æˆè®°</div>
                        </div>

                        <h4 style="margin: 15px 0 10px; color: #666; font-size: 14px;">çŠ¶æ€æ ‡ç­¾:</h4>
                        <div class="sticker-preset-grid">
                            <div class="sticker-preset" onclick="toggleSticker(this, 'é‡ç‚¹')" style="background: #FF6B6B;">é‡ç‚¹</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'éš¾ç‚¹')" style="background: #FFA07A;">éš¾ç‚¹</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'æ˜“é”™')" style="background: #FFD700;">æ˜“é”™</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'å·²æŒæ¡âœ“')" style="background: #90EE90;">å·²æŒæ¡âœ“</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'å¾…å¤ä¹ ')" style="background: #ADD8E6;">å¾…å¤ä¹ </div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'ä»Šæ—¥ç›®æ ‡')" style="background: #FFB6D9;">ä»Šæ—¥ç›®æ ‡</div>
                        </div>

                        <h4 style="margin: 15px 0 10px; color: #666; font-size: 14px;">DAYæ ‡ç­¾:</h4>
                        <div class="sticker-preset-grid">
                            <div class="sticker-preset" onclick="toggleSticker(this, 'DAY 1')" style="background: #C1E1FF;">DAY 1</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'DAY 2')" style="background: #C1E1FF;">DAY 2</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'DAY 3')" style="background: #C1E1FF;">DAY 3</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'DAY 7')" style="background: #C1E1FF;">DAY 7</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'DAY 14')" style="background: #C1E1FF;">DAY 14</div>
                            <div class="sticker-preset" onclick="toggleSticker(this, 'DAY 30')" style="background: #C1E1FF;">DAY 30</div>
                        </div>

                        <div class="custom-sticker-input">
                            <input type="text" id="customStickerText" placeholder="è¾“å…¥è‡ªå®šä¹‰æ–‡å­—è´´çº¸" style="flex: 1;">
                            <select id="customStickerBg" style="width: 150px;">
                                <option value="#FFB6C1">ç²‰è‰²èƒŒæ™¯</option>
                                <option value="#FFD700">é»„è‰²èƒŒæ™¯</option>
                                <option value="#87CEEB">è“è‰²èƒŒæ™¯</option>
                                <option value="#98FB98">ç»¿è‰²èƒŒæ™¯</option>
                                <option value="#DDA0DD">ç´«è‰²èƒŒæ™¯</option>
                                <option value="#FFA07A">æ©™è‰²èƒŒæ™¯</option>
                            </select>
                            <button onclick="addCustomSticker()" style="padding: 10px 25px;">æ·»åŠ </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 10px; border: 2px solid #ddd;">
                        <label style="font-weight: 600; display: block; margin-bottom: 10px;">å·²é€‰æ‹©çš„è´´çº¸:</label>
                        <div id="selectedStickers" style="display: flex; flex-wrap: wrap; gap: 10px; min-height: 40px;">
                            <span style="color: #999;">æœªé€‰æ‹©è´´çº¸</span>
                        </div>
                    </div>

                    <hr style="margin: 30px 0; border: none; border-top: 2px solid #ddd;">

                    <h3 style="color: #FF6B9D; margin-bottom: 20px;">æ‰‹ç»˜è£…é¥°å…ƒç´ </h3>

                    <div class="config-row">
                        <div class="config-item">
                            <label>
                                <input type="checkbox" id="enableArrows" checked style="margin-right: 10px;">
                                æ·»åŠ æ‰‹ç»˜ç®­å¤´
                            </label>
                        </div>

                        <div class="config-item">
                            <label>
                                <input type="checkbox" id="enableCircles" checked style="margin-right: 10px;">
                                æ·»åŠ åœ†åœˆæ ‡æ³¨
                            </label>
                        </div>

                        <div class="config-item">
                            <label>
                                <input type="checkbox" id="enableEmojis" checked style="margin-right: 10px;">
                                æ·»åŠ è¡¨æƒ…è£…é¥° (â­ğŸ’–âœ¨)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æŠ€æœ¯å‚æ•° -->
            <div class="section">
                <h2>âš™ï¸ ç¬¬å››æ­¥: é…ç½®ç”Ÿæˆå‚æ•°</h2>

                <div class="config-panel">
                    <div class="config-row">
                        <div class="config-item">
                            <label>ç”Ÿæˆç‰ˆæœ¬æ•°é‡:</label>
                            <input type="number" id="versionCount" min="1" max="15" value="5">
                            <p style="color: #666; font-size: 13px; margin-top: 5px;">æ¯ä¸ªç‰ˆæœ¬å°†ä½¿ç”¨ä¸åŒçš„è£…é¥°ç»„åˆ</p>
                        </div>

                        <div class="config-item">
                            <label>æŠ€æœ¯å»é‡å¼ºåº¦:</label>
                            <select id="strengthLevel">
                                <option value="light">è½»åº¦</option>
                                <option value="medium" selected>ä¸­åº¦ (æ¨è)</option>
                                <option value="heavy">é‡åº¦</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label>
                                <input type="checkbox" id="enableTechDedup" checked style="margin-right: 10px;">
                                å¯ç”¨æŠ€æœ¯å»é‡ (MD5/åƒç´ /å…ƒæ•°æ®)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button id="generateBtn" style="font-size: 19px; padding: 18px 50px;">ğŸš€ å¼€å§‹ç”Ÿæˆè£…é¥°ç‰ˆæœ¬</button>
                </div>

                <div class="status-message" id="configStatus"></div>
            </div>

            <!-- ç”Ÿæˆè¿›åº¦ -->
            <div class="section" id="progressSection" style="display: none;">
                <h2>â³ æ­£åœ¨ç”Ÿæˆ...</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar">0%</div>
                </div>
                <div class="status-message" id="progressStatus"></div>
            </div>

            <!-- ç»“æœå±•ç¤º -->
            <div class="section" id="resultSection" style="display: none;">
                <h2>âœ… ç”Ÿæˆå®Œæˆ</h2>

                <div class="result-panel">
                    <h3 style="color: #28a745;">ğŸ“Š MD5å€¼éªŒè¯</h3>
                    <p style="color: #666; margin-bottom: 15px;">æ¯å¼ å›¾ç‰‡çš„ä¸åŒç‰ˆæœ¬éƒ½æœ‰ä¸åŒçš„MD5å€¼</p>
                    <div id="md5Container"></div>
                </div>

                <div class="info-box" style="background: #d4edda; border-left-color: #28a745;">
                    <h4 style="color: #28a745;">ğŸ‰ æ‰€æœ‰ç‰ˆæœ¬å·²ç”Ÿæˆ!</h4>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>å·²ç”Ÿæˆ <span id="totalVersions" class="highlight">0</span> ä¸ªç‰ˆæœ¬</li>
                        <li>æ¯ä¸ªç‰ˆæœ¬åŒ…å« <span id="totalImages" class="highlight">0</span> å¼ å›¾ç‰‡</li>
                        <li>æ¯ä¸ªç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„è¾¹æ¡†æ ·å¼å’Œè´´çº¸ç»„åˆ</li>
                        <li>æ‰€æœ‰ç‰ˆæœ¬å·²æŒ‰æ–‡ä»¶å¤¹æ‰“åŒ…</li>
                    </ul>
                </div>

                <div class="btn-group">
                    <button id="downloadBtn" style="background: #28a745; font-size: 19px; padding: 18px 50px;">
                        ğŸ“¦ ä¸‹è½½æ‰€æœ‰ç‰ˆæœ¬ (ZIP)
                    </button>
                    <button id="restartBtn" style="background: #6c757d;">
                        ğŸ”„ é‡æ–°å¼€å§‹
                    </button>
                </div>

                <div class="status-message" id="resultStatus"></div>
            </div>
        </div>
    </div>

    <script>
        console.log('=== å°çº¢ä¹¦å›¾ç‰‡å»é‡å·¥å…· Pro ===');

        // å…¨å±€å˜é‡
        let uploadedImages = [];
        let processedVersions = [];
        let md5Records = [];
        let selectedStickers = [];
        let currentTheme = 'fresh';

        // ä¸»é¢˜é…ç½®
        const themeConfigs = {
            fresh: {
                name: 'æ¸…æ–°æ‰‹å¸é£',
                borderStyle: 'wavy',
                borderColors: ['#FFB6C1', '#FFC0CB', '#E6E6FA'],
                stickers: ['åŠ æ²¹', 'DAY 1', 'ä½ çœŸæ£’!'],
                emojis: ['â­', 'âœ¨', 'ğŸ’–', 'ğŸŒ¸'],
                enableArrows: true,
                enableCircles: true
            },
            notebook: {
                name: 'ç¬”è®°æœ¬é£æ ¼',
                borderStyle: 'notebook',
                borderColors: ['#DEB887', '#D2B48C'],
                stickers: ['DAY 1', 'é‡ç‚¹', 'å·²æŒæ¡âœ“'],
                emojis: ['ğŸ“', 'âœ“', 'âœï¸'],
                enableArrows: true,
                enableCircles: false
            },
            motivational: {
                name: 'æ¿€åŠ±æ‰“å¡é£',
                borderStyle: 'gradient',
                borderColors: ['#FFD700', '#FFA500', '#FF69B4'],
                stickers: ['ä½ çœŸæ£’!', 'å¤ªå‰å®³äº†!', 'èƒ½é‡æ»¡æ»¡'],
                emojis: ['ğŸ†', 'ğŸ¯', 'ğŸ’¯', 'ğŸŒŸ'],
                enableArrows: false,
                enableCircles: true
            },
            serious: {
                name: 'ä¸¥è‚ƒå­¦ä¹ é£',
                borderStyle: 'solid',
                borderColors: ['#333333', '#666666'],
                stickers: ['é‡ç‚¹', 'éš¾ç‚¹', 'æ˜“é”™'],
                emojis: [],
                enableArrows: true,
                enableCircles: true
            },
            cute: {
                name: 'å¯çˆ±å¡é€šé£',
                borderStyle: 'decorated',
                borderColors: ['#FFB6D9', '#C1E1FF', '#FFE5EC'],
                stickers: ['åŠ æ²¹', 'ä½ çœŸæ£’!', 'DAY 1'],
                emojis: ['ğŸ’–', 'ğŸŒ¸', 'ğŸ€', 'ğŸŒˆ'],
                enableArrows: false,
                enableCircles: false
            }
        };

        // é¡µé¢åŠ è½½
        window.addEventListener('load', function() {
            console.log('=== é¡µé¢åŠ è½½å®Œæˆ ===');
            initializeUpload();
            initializeGenerate();
            initializeDownload();
            applyTheme('fresh');
        });

        // é€‰æ‹©ä¸»é¢˜
        function selectTheme(theme) {
            currentTheme = theme;

            // æ›´æ–°UI
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('active');
            });

            const themeMap = {
                'fresh': 'theme1',
                'notebook': 'theme2',
                'motivational': 'theme3',
                'serious': 'theme4',
                'cute': 'theme5'
            };

            document.getElementById(themeMap[theme]).classList.add('active');
            document.getElementById('currentThemeName').textContent = themeConfigs[theme].name;

            applyTheme(theme);
        }

        // åº”ç”¨ä¸»é¢˜é…ç½®
        function applyTheme(theme) {
            const config = themeConfigs[theme];

            // åº”ç”¨è¾¹æ¡†æ ·å¼
            document.getElementById('borderStyle').value = config.borderStyle;

            // åº”ç”¨è´´çº¸
            selectedStickers = [...config.stickers];
            updateSelectedStickersDisplay();

            // åº”ç”¨è£…é¥°å…ƒç´ 
            document.getElementById('enableArrows').checked = config.enableArrows;
            document.getElementById('enableCircles').checked = config.enableCircles;
            document.getElementById('enableEmojis').checked = true;
        }

        // åˆ‡æ¢è´´çº¸é€‰æ‹©
        function toggleSticker(element, text) {
            const index = selectedStickers.indexOf(text);

            if (index === -1) {
                selectedStickers.push(text);
                element.classList.add('selected');
            } else {
                selectedStickers.splice(index, 1);
                element.classList.remove('selected');
            }

            updateSelectedStickersDisplay();
        }

        // æ·»åŠ è‡ªå®šä¹‰è´´çº¸
        function addCustomSticker() {
            const text = document.getElementById('customStickerText').value.trim();
            const bg = document.getElementById('customStickerBg').value;

            if (!text) {
                alert('è¯·è¾“å…¥æ–‡å­—å†…å®¹');
                return;
            }

            if (selectedStickers.length >= 10) {
                alert('æœ€å¤šé€‰æ‹©10ä¸ªè´´çº¸');
                return;
            }

            selectedStickers.push(text);
            updateSelectedStickersDisplay();

            document.getElementById('customStickerText').value = '';
        }

        // æ›´æ–°å·²é€‰è´´çº¸æ˜¾ç¤º
        function updateSelectedStickersDisplay() {
            const container = document.getElementById('selectedStickers');

            if (selectedStickers.length === 0) {
                container.innerHTML = '<span style="color: #999;">æœªé€‰æ‹©è´´çº¸</span>';
                return;
            }

            container.innerHTML = selectedStickers.map((text, index) => `
                <div style="background: #FF6B9D; color: white; padding: 5px 15px; border-radius: 15px; display: flex; align-items: center; gap: 10px;">
                    <span>${text}</span>
                    <button onclick="removeSticker(${index})" style="background: transparent; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: 18px; font-weight: bold;">Ã—</button>
                </div>
            `).join('');
        }

        // ç§»é™¤è´´çº¸
        function removeSticker(index) {
            selectedStickers.splice(index, 1);
            updateSelectedStickersDisplay();

            // æ›´æ–°é¢„è®¾è´´çº¸çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.sticker-preset').forEach(el => {
                const text = el.textContent;
                if (!selectedStickers.includes(text)) {
                    el.classList.remove('selected');
                }
            });
        }

        // åˆå§‹åŒ–ä¸Šä¼ 
        function initializeUpload() {
            const uploadZone = document.getElementById('uploadZone');
            const imageInput = document.getElementById('imageInput');

            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = '#FF1493';
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.style.borderColor = '#FF6B9D';
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = '#FF6B9D';
                handleFiles(e.dataTransfer.files);
            });

            imageInput.addEventListener('change', function() {
                handleFiles(this.files);
            });

            document.getElementById('clearAll').addEventListener('click', () => {
                uploadedImages = [];
                document.getElementById('imageGrid').innerHTML = '';
                document.getElementById('uploadButtons').style.display = 'none';
                showStatus('uploadStatus', '', '');
            });
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFiles(files) {
            if (files.length > 20) {
                showStatus('uploadStatus', 'æœ€å¤šæ”¯æŒ20å¼ å›¾ç‰‡', 'error');
                return;
            }

            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.push({
                        name: file.name,
                        dataUrl: e.target.result,
                        file: file
                    });
                    displayImages();
                };
                reader.readAsDataURL(file);
            });
        }

        // æ˜¾ç¤ºå›¾ç‰‡
        function displayImages() {
            const grid = document.getElementById('imageGrid');
            grid.innerHTML = '';

            uploadedImages.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';
                item.innerHTML = `
                    <img src="${img.dataUrl}">
                    <button onclick="removeImage(${index})" style="position: absolute; top: 18px; right: 18px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 20px;">Ã—</button>
                    <div style="margin-top: 10px; font-size: 13px; color: #666; text-align: center; word-break: break-all;">${img.name}</div>
                `;
                grid.appendChild(item);
            });

            document.getElementById('uploadButtons').style.display = uploadedImages.length > 0 ? 'flex' : 'none';
            showStatus('uploadStatus', `âœ… å·²ä¸Šä¼  ${uploadedImages.length} å¼ å›¾ç‰‡`, 'success');
        }

        // åˆ é™¤å›¾ç‰‡
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            displayImages();
        }

        // åˆå§‹åŒ–ç”Ÿæˆ
        function initializeGenerate() {
            document.getElementById('generateBtn').addEventListener('click', generateVersions);
        }

        // ç”Ÿæˆç‰ˆæœ¬
        async function generateVersions() {
            if (uploadedImages.length === 0) {
                showStatus('configStatus', 'è¯·å…ˆä¸Šä¼ å›¾ç‰‡', 'error');
                return;
            }

            const versionCount = parseInt(document.getElementById('versionCount').value) || 5;
            const borderStyle = document.getElementById('borderStyle').value;
            const borderWidth = parseInt(document.getElementById('borderWidth').value) || 25;
            const borderRadius = parseInt(document.getElementById('borderRadius').value) || 15;
            const enableArrows = document.getElementById('enableArrows').checked;
            const enableCircles = document.getElementById('enableCircles').checked;
            const enableEmojis = document.getElementById('enableEmojis').checked;
            const enableTechDedup = document.getElementById('enableTechDedup').checked;
            const strength = document.getElementById('strengthLevel').value;

            if (selectedStickers.length === 0) {
                const confirm = window.confirm('æ‚¨è¿˜æ²¡æœ‰é€‰æ‹©ä»»ä½•è´´çº¸,æ˜¯å¦ç»§ç»­?');
                if (!confirm) return;
            }

            // æ˜¾ç¤ºè¿›åº¦
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';

            processedVersions = [];
            md5Records = [];

            const totalTasks = uploadedImages.length * versionCount;
            let completedTasks = 0;

            showProgressStatus('â³ å¼€å§‹ç”Ÿæˆè£…é¥°ç‰ˆæœ¬...', 'info');

            const config = themeConfigs[currentTheme];

            // ç”Ÿæˆæ¯ä¸ªç‰ˆæœ¬
            for (let v = 0; v < versionCount; v++) {
                const versionImages = [];

                for (let i = 0; i < uploadedImages.length; i++) {
                    const originalImage = uploadedImages[i];

                    const decorationConfig = {
                        borderStyle: borderStyle,
                        borderWidth: borderWidth + Math.floor(Math.random() * 10),
                        borderRadius: borderRadius,
                        borderColor: config.borderColors[v % config.borderColors.length],
                        stickers: selectedStickers,
                        emojis: enableEmojis ? config.emojis : [],
                        enableArrows: enableArrows,
                        enableCircles: enableCircles
                    };

                    const processedImage = await processImageWithDecoration(
                        originalImage,
                        v,
                        decorationConfig,
                        enableTechDedup,
                        strength
                    );

                    versionImages.push(processedImage);

                    const md5 = await calculateMD5(processedImage.blob);
                    md5Records.push({
                        imageName: originalImage.name,
                        version: v + 1,
                        md5: md5
                    });

                    completedTasks++;
                    const progress = Math.round((completedTasks / totalTasks) * 100);
                    updateProgress(progress);
                    showProgressStatus(`æ­£åœ¨å¤„ç†: ç‰ˆæœ¬${v + 1} - ${originalImage.name}`, 'info');
                }

                processedVersions.push({
                    version: v + 1,
                    images: versionImages
                });
            }

            showProgressStatus('âœ… æ‰€æœ‰ç‰ˆæœ¬ç”Ÿæˆå®Œæˆ!', 'success');
            displayResults();
        }

        // å¤„ç†å›¾ç‰‡å¹¶æ·»åŠ è£…é¥°
        async function processImageWithDecoration(originalImage, versionIndex, decorationConfig, enableTechDedup, strength) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const borderW = decorationConfig.borderWidth;
                    const newWidth = img.width + borderW * 2;
                    const newHeight = img.height + borderW * 2;

                    canvas.width = newWidth;
                    canvas.height = newHeight;
                    const ctx = canvas.getContext('2d');

                    // 1. ç»˜åˆ¶è¾¹æ¡†èƒŒæ™¯
                    drawBorderBackground(ctx, newWidth, newHeight, decorationConfig);

                    // 2. ç»˜åˆ¶åŸå›¾
                    if (decorationConfig.borderRadius > 0) {
                        ctx.save();
                        roundRect(ctx, borderW, borderW, img.width, img.height, decorationConfig.borderRadius);
                        ctx.clip();
                    }
                    ctx.drawImage(img, borderW, borderW, img.width, img.height);
                    if (decorationConfig.borderRadius > 0) {
                        ctx.restore();
                    }

                    // 3. ç»˜åˆ¶æ‰‹ç»˜è¾¹æ¡†è£…é¥°
                    drawBorderDecoration(ctx, newWidth, newHeight, borderW, decorationConfig);

                    // 4. æ·»åŠ æ–‡å­—è´´çº¸
                    if (decorationConfig.stickers.length > 0) {
                        addTextStickers(ctx, newWidth, newHeight, decorationConfig.stickers, versionIndex);
                    }

                    // 5. æ·»åŠ emojiè£…é¥°
                    if (decorationConfig.emojis.length > 0) {
                        addEmojiDecorations(ctx, newWidth, newHeight, decorationConfig.emojis, versionIndex);
                    }

                    // 6. æ·»åŠ æ‰‹ç»˜å…ƒç´ 
                    if (decorationConfig.enableArrows) {
                        drawHandDrawnArrows(ctx, newWidth, newHeight, versionIndex);
                    }
                    if (decorationConfig.enableCircles) {
                        drawHandDrawnCircles(ctx, newWidth, newHeight, versionIndex);
                    }

                    // 7. æŠ€æœ¯å»é‡
                    if (enableTechDedup) {
                        applyTechnicalDeduplication(ctx, canvas, strength, versionIndex);
                    }

                    // è½¬æ¢ä¸ºBlob
                    const quality = 0.92 + Math.random() * 0.06;
                    canvas.toBlob((blob) => {
                        resolve({
                            name: originalImage.name,
                            blob: blob
                        });
                    }, 'image/jpeg', quality);
                };
                img.src = originalImage.dataUrl;
            });
        }

        // ç»˜åˆ¶è¾¹æ¡†èƒŒæ™¯
        function drawBorderBackground(ctx, width, height, config) {
            const style = config.borderStyle;
            const color = config.borderColor;

            if (style === 'solid') {
                ctx.fillStyle = color;
                ctx.fillRect(0, 0, width, height);
            } else if (style === 'gradient') {
                const gradient = ctx.createLinearGradient(0, 0, 0, height);
                gradient.addColorStop(0, color);
                gradient.addColorStop(1, adjustColorBrightness(color, -20));
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
            } else if (style === 'notebook') {
                ctx.fillStyle = '#FFF8DC';
                ctx.fillRect(0, 0, width, height);
                // èºæ—‹çº¿
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 5;
                for (let y = 50; y < height; y += 30) {
                    ctx.beginPath();
                    ctx.arc(15, y, 8, 0, Math.PI * 2);
                    ctx.stroke();
                }
                // æ¨ªçº¿
                ctx.strokeStyle = '#DEB887';
                ctx.lineWidth = 1;
                for (let y = 80; y < height; y += 40) {
                    ctx.beginPath();
                    ctx.moveTo(40, y);
                    ctx.lineTo(width - 20, y);
                    ctx.stroke();
                }
            } else {
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, width, height);
            }
        }

        // ç»˜åˆ¶è¾¹æ¡†è£…é¥°
        function drawBorderDecoration(ctx, width, height, borderW, config) {
            ctx.strokeStyle = config.borderColor;
            ctx.lineWidth = 3;

            if (config.borderStyle === 'wavy') {
                // æ‰‹ç»˜æ³¢æµªè¾¹æ¡†
                drawWavyBorder(ctx, borderW, borderW, width - borderW, height - borderW);
            } else if (config.borderStyle === 'dashed') {
                // è™šçº¿è¾¹æ¡†
                ctx.setLineDash([10, 5]);
                ctx.strokeRect(borderW + 5, borderW + 5, width - borderW * 2 - 10, height - borderW * 2 - 10);
                ctx.setLineDash([]);
            } else if (config.borderStyle === 'decorated') {
                // è£…é¥°è¾¹æ¡† (å››è§’çˆ±å¿ƒ)
                const positions = [
                    {x: borderW + 10, y: borderW + 10},
                    {x: width - borderW - 10, y: borderW + 10},
                    {x: borderW + 10, y: height - borderW - 10},
                    {x: width - borderW - 10, y: height - borderW - 10}
                ];
                ctx.font = '30px Arial';
                ctx.fillStyle = config.borderColor;
                positions.forEach(pos => {
                    ctx.fillText('ğŸ’–', pos.x, pos.y);
                });
            }
        }

        // ç»˜åˆ¶æ³¢æµªè¾¹æ¡†
        function drawWavyBorder(ctx, x, y, width, height) {
            const amplitude = 5;
            const frequency = 0.05;

            ctx.beginPath();

            // ä¸Šè¾¹
            for (let i = 0; i <= width; i += 2) {
                const wave = Math.sin(i * frequency) * amplitude + (Math.random() - 0.5) * 2;
                if (i === 0) {
                    ctx.moveTo(x + i, y + wave);
                } else {
                    ctx.lineTo(x + i, y + wave);
                }
            }

            // å³è¾¹
            for (let i = 0; i <= height; i += 2) {
                const wave = Math.sin(i * frequency) * amplitude + (Math.random() - 0.5) * 2;
                ctx.lineTo(width + wave, y + i);
            }

            // ä¸‹è¾¹
            for (let i = width; i >= 0; i -= 2) {
                const wave = Math.sin(i * frequency) * amplitude + (Math.random() - 0.5) * 2;
                ctx.lineTo(x + i, height + wave);
            }

            // å·¦è¾¹
            for (let i = height; i >= 0; i -= 2) {
                const wave = Math.sin(i * frequency) * amplitude + (Math.random() - 0.5) * 2;
                ctx.lineTo(x + wave, y + i);
            }

            ctx.closePath();
            ctx.stroke();
        }

        // æ·»åŠ æ–‡å­—è´´çº¸
        function addTextStickers(ctx, width, height, stickers, versionIndex) {
            const positions = [
                {x: 50, y: 50},
                {x: width - 150, y: 50},
                {x: 50, y: height - 50},
                {x: width - 150, y: height - 50},
                {x: width / 2 - 75, y: 50}
            ];

            const colors = ['#FFD700', '#FF69B4', '#87CEEB', '#98FB98', '#DDA0DD', '#FFA07A'];

            stickers.slice(0, 5).forEach((text, index) => {
                const pos = positions[index];
                const bgColor = colors[(index + versionIndex) % colors.length];

                drawTextSticker(ctx, text, pos.x, pos.y, bgColor);
            });
        }

        // ç»˜åˆ¶å•ä¸ªæ–‡å­—è´´çº¸
        function drawTextSticker(ctx, text, x, y, bgColor) {
            ctx.font = 'bold 18px Microsoft YaHei';
            const metrics = ctx.measureText(text);
            const textWidth = metrics.width;
            const padding = 12;
            const stickerWidth = textWidth + padding * 2;
            const stickerHeight = 35;

            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = bgColor;
            ctx.beginPath();
            ctx.roundRect(x, y, stickerWidth, stickerHeight, 15);
            ctx.fill();

            // ç»˜åˆ¶æ–‡å­—
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, x + stickerWidth / 2, y + stickerHeight / 2);

            // é‡ç½®å¯¹é½æ–¹å¼
            ctx.textAlign = 'left';
            ctx.textBaseline = 'alphabetic';
        }

        // æ·»åŠ emojiè£…é¥°
        function addEmojiDecorations(ctx, width, height, emojis, versionIndex) {
            const positions = [
                {x: width - 60, y: height - 60},
                {x: 30, y: height / 2},
                {x: width - 60, y: height / 2},
                {x: width / 2, y: height - 60}
            ];

            ctx.font = '35px Arial';
            positions.slice(0, 3).forEach((pos, index) => {
                const emoji = emojis[(index + versionIndex) % emojis.length];
                const randomOffsetX = (Math.random() - 0.5) * 20;
                const randomOffsetY = (Math.random() - 0.5) * 20;
                ctx.fillText(emoji, pos.x + randomOffsetX, pos.y + randomOffsetY);
            });
        }

        // ç»˜åˆ¶æ‰‹ç»˜ç®­å¤´
        function drawHandDrawnArrows(ctx, width, height, versionIndex) {
            if (versionIndex % 2 !== 0) return; // æ¯éš”ä¸€ä¸ªç‰ˆæœ¬ç»˜åˆ¶

            ctx.strokeStyle = '#FF6B6B';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';

            const startX = width * 0.7;
            const startY = height * 0.3;
            const endX = width * 0.85;
            const endY = height * 0.4;

            // ç»˜åˆ¶ç®­å¤´ä¸»ä½“ (æ‰‹ç»˜æ›²çº¿)
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            const cp1x = startX + (endX - startX) * 0.3 + (Math.random() - 0.5) * 10;
            const cp1y = startY + (endY - startY) * 0.3 + (Math.random() - 0.5) * 10;
            const cp2x = startX + (endX - startX) * 0.7 + (Math.random() - 0.5) * 10;
            const cp2y = startY + (endY - startY) * 0.7 + (Math.random() - 0.5) * 10;
            ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);
            ctx.stroke();

            // ç»˜åˆ¶ç®­å¤´å¤´éƒ¨
            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - 10, endY - 8);
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - 10, endY + 8);
            ctx.stroke();
        }

        // ç»˜åˆ¶æ‰‹ç»˜åœ†åœˆ
        function drawHandDrawnCircles(ctx, width, height, versionIndex) {
            if (versionIndex % 3 !== 0) return;

            ctx.strokeStyle = '#4A90E2';
            ctx.lineWidth = 2;

            const centerX = width * 0.2;
            const centerY = height * 0.7;
            const radius = 40;

            // æ‰‹ç»˜åœ†åœˆæ•ˆæœ
            ctx.beginPath();
            for (let angle = 0; angle < Math.PI * 2; angle += 0.1) {
                const r = radius + (Math.random() - 0.5) * 3;
                const x = centerX + Math.cos(angle) * r;
                const y = centerY + Math.sin(angle) * r;
                if (angle === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.stroke();
        }

        // åº”ç”¨æŠ€æœ¯å»é‡
        function applyTechnicalDeduplication(ctx, canvas, strength, versionIndex) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            let pixelShift = strength === 'light' ? 1 : strength === 'medium' ? 2 : 3;

            for (let i = 0; i < data.length; i += 4) {
                if (Math.random() < 0.25) {
                    const shift = Math.floor(Math.random() * (pixelShift * 2 + 1)) - pixelShift;
                    data[i] = Math.max(0, Math.min(255, data[i] + shift));
                    data[i + 1] = Math.max(0, Math.min(255, data[i + 1] + shift));
                    data[i + 2] = Math.max(0, Math.min(255, data[i + 2] + shift));
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // æ·»åŠ ä¸å¯è§æ°´å°
            const timestamp = new Date().getTime() + versionIndex + Math.random();
            ctx.fillStyle = 'rgba(255, 255, 255, 0.002)';
            ctx.font = '1px Arial';
            ctx.fillText(timestamp.toString(), 0, canvas.height - 1);
        }

        // åœ†è§’çŸ©å½¢
        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        // è°ƒæ•´é¢œè‰²äº®åº¦
        function adjustColorBrightness(color, amount) {
            const hex = color.replace('#', '');
            const r = Math.max(0, Math.min(255, parseInt(hex.substring(0, 2), 16) + amount));
            const g = Math.max(0, Math.min(255, parseInt(hex.substring(2, 4), 16) + amount));
            const b = Math.max(0, Math.min(255, parseInt(hex.substring(4, 6), 16) + amount));
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }

        // è®¡ç®—MD5
        async function calculateMD5(blob) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const spark = new SparkMD5.ArrayBuffer();
                    spark.append(e.target.result);
                    resolve(spark.end());
                };
                reader.readAsArrayBuffer(blob);
            });
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress(percent) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percent + '%';
            progressBar.textContent = percent + '%';
        }

        // æ˜¾ç¤ºè¿›åº¦çŠ¶æ€
        function showProgressStatus(message, type) {
            showStatus('progressStatus', message, type);
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';

            document.getElementById('totalVersions').textContent = processedVersions.length;
            document.getElementById('totalImages').textContent = uploadedImages.length;

            const container = document.getElementById('md5Container');
            container.innerHTML = '';

            uploadedImages.forEach(img => {
                const table = document.createElement('table');
                table.className = 'md5-table';

                let tableHTML = `
                    <thead>
                        <tr><th colspan="2">${img.name}</th></tr>
                        <tr><th>ç‰ˆæœ¬</th><th>MD5å€¼</th></tr>
                    </thead>
                    <tbody>
                `;

                processedVersions.forEach(version => {
                    const record = md5Records.find(r =>
                        r.imageName === img.name && r.version === version.version
                    );
                    if (record) {
                        tableHTML += `
                            <tr>
                                <td>ç‰ˆæœ¬ ${version.version}</td>
                                <td>${record.md5}</td>
                            </tr>
                        `;
                    }
                });

                tableHTML += '</tbody>';
                table.innerHTML = tableHTML;
                container.appendChild(table);
            });

            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        // åˆå§‹åŒ–ä¸‹è½½
        function initializeDownload() {
            document.getElementById('downloadBtn').addEventListener('click', downloadAll);
            document.getElementById('restartBtn').addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—?')) {
                    location.reload();
                }
            });
        }

        // ä¸‹è½½æ‰€æœ‰ç‰ˆæœ¬
        async function downloadAll() {
            if (processedVersions.length === 0) {
                alert('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹');
                return;
            }

            showStatus('resultStatus', 'â³ æ­£åœ¨æ‰“åŒ…ZIP...', 'info');

            const zip = new JSZip();

            processedVersions.forEach(version => {
                const folder = zip.folder(`ç‰ˆæœ¬${version.version}`);
                version.images.forEach(img => {
                    folder.file(img.name, img.blob);
                });
            });

            let md5Text = '# MD5å€¼è®°å½•\n\n';
            uploadedImages.forEach(img => {
                md5Text += `## ${img.name}\n`;
                processedVersions.forEach(version => {
                    const record = md5Records.find(r =>
                        r.imageName === img.name && r.version === version.version
                    );
                    if (record) {
                        md5Text += `ç‰ˆæœ¬${version.version}: ${record.md5}\n`;
                    }
                });
                md5Text += '\n';
            });

            zip.file('MD5è®°å½•.txt', md5Text);

            const content = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å°çº¢ä¹¦å›¾ç‰‡_${themeConfigs[currentTheme].name}_${new Date().getTime()}.zip`;
            a.click();
            URL.revokeObjectURL(url);

            showStatus('resultStatus', 'âœ… ZIPä¸‹è½½æˆåŠŸ!', 'success');
        }

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(id, message, type) {
            const el = document.getElementById(id);
            el.textContent = message;
            el.className = 'status-message' + (message ? ' show ' + type : '');
        }

        console.log('=== åˆå§‹åŒ–å®Œæˆ ===');
    </script>
</body>
</html>
